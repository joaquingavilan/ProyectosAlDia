{% extends request.base_template %}
{% load static %}

{% block content %}
<div class="container">
    <h2>Editar Administrador</h2>
    <div class="alert alert-danger" style="display:none;" id="errorContainer"></div>
    <form id="editarEncargadoForm">
        {% csrf_token %}
        <div class="form-group">
            <label for="first_name">Nombre:</label>
            <input type="text" class="form-control" id="first_name" name="first_name" value="{{ encargado.first_name }}">
        </div>
        <div class="form-group">
            <label for="last_name">Apellido:</label>
            <input type="text" class="form-control" id="last_name" name="last_name" value="{{ encargado.last_name }}">
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ encargado.email }}">
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
    </form>
</div>

{% block extra_js %}
<script>
document.getElementById('editarEncargadoForm').addEventListener('submit', function(event) {
    event.preventDefault();

    let formData = new FormData(this);

    fetch("{% url 'editar_encargado' encargado.id %}", {
        method: "POST",
        body: formData,
        headers: {
            "X-CSRFToken": this.querySelector("[name=csrfmiddlewaretoken]").value,
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            window.location.href = "{% url 'ver_administradores' %}";
        } else {
            let errorContainer = document.getElementById("errorContainer");
            errorContainer.innerHTML = '';

            if (data.errors) {
                for (let key in data.errors) {
                    let error = data.errors[key];
                    let p = document.createElement("p");
                    p.textContent = error;
                    errorContainer.appendChild(p);
                }
            } else if (data.message) {
                let p = document.createElement("p");
                p.textContent = data.message;
                errorContainer.appendChild(p);
            }

            errorContainer.style.display = "block";
        }
    });
});
</script>
{% endblock %}